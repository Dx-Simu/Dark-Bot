<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MASTER_CLOUD_V3</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code&display=swap');
        body { background: #020205; color: #00f2ff; font-family: 'Fira Code', monospace; overflow: hidden; }
        #editor { background: #05050a; color: #00f2ff; border: 1px solid #111; width: 100%; height: 50vh; padding: 15px; outline: none; resize: none; border-radius: 8px; font-size: 14px; }
        .terminal { background: #000; height: 28vh; overflow-y: auto; padding: 10px; font-size: 12px; border: 1px solid #1a1a2e; }
        .neon-btn { border: 1px solid #00f2ff; padding: 4px 12px; transition: 0.3s; font-size: 11px; }
        .neon-btn:hover { background: #00f2ff; color: #000; box-shadow: 0 0 15px #00f2ff; }
        .sidebar { width: 280px; border-right: 1px solid #1a1a2e; background: rgba(0,0,0,0.5); }
    </style>
</head>
<body class="flex flex-col h-screen">

    <header class="p-4 border-b border-cyan-900 flex justify-between items-center bg-black/80">
        <h1 class="text-xl font-bold tracking-tighter neon-text">NEON_PAAS_V3</h1>
        <div class="flex gap-3">
            <input id="git-url" type="text" placeholder="GitHub Repo URL" class="bg-black border border-cyan-900 px-2 text-xs w-48 outline-none focus:border-cyan-400">
            <button onclick="syncGit()" class="neon-btn">GIT_SYNC</button>
            <span id="auto-save-status" class="text-[10px] opacity-40 mt-2 italic">AUTO_SAVE: ON</span>
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden">
        <aside class="sidebar p-4 flex flex-col gap-6">
            <div>
                <h3 class="text-[10px] opacity-50 mb-3 uppercase">Filesystem</h3>
                <div id="file-list" class="space-y-2"></div>
                <input id="new-name" type="text" placeholder="new_file.py" class="w-full bg-black border border-cyan-900 p-1 text-xs mt-4 outline-none">
                <button onclick="createNew()" class="w-full bg-cyan-900 text-[10px] py-1 mt-1 font-bold">CREATE</button>
            </div>
            
            <div class="mt-auto border-t border-cyan-900 pt-4">
                <h3 class="text-[10px] opacity-50 mb-2 uppercase">Quick Command</h3>
                <input id="term-cmd" type="text" placeholder="pip install..." class="w-full bg-black border border-cyan-900 p-1 text-xs outline-none">
                <button onclick="runCmd()" class="w-full border border-cyan-900 text-[10px] py-1 mt-1">EXECUTE</button>
            </div>
        </aside>

        <main class="flex-1 p-4 flex flex-col gap-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center gap-4">
                    <span id="active-file-label" class="text-sm font-bold text-white">Select File</span>
                    <span id="uptime-badge" class="hidden text-[10px] border border-green-500 px-2 text-green-500">LIVE</span>
                </div>
                <div class="flex gap-2">
                    <button onclick="saveFile()" class="neon-btn">SAVE</button>
                    <button onclick="deploy()" class="neon-btn !bg-cyan-500 !text-black">DEPLOY</button>
                    <button onclick="stop()" class="neon-btn !border-red-600 !text-red-600">STOP</button>
                </div>
            </div>

            <textarea id="editor" spellcheck="false" oninput="handleTyping()"></textarea>

            <div class="rounded-lg overflow-hidden border border-cyan-900">
                <div class="bg-cyan-950/30 p-1 px-4 text-[9px] uppercase opacity-60">System Console Logs</div>
                <div id="terminal" class="terminal"></div>
            </div>
        </main>
    </div>

    <script>
        const socket = io();
        let activeFile = "";
        let saveTimeout;

        async function fetchFiles() {
            const res = await fetch('/api/projects');
            const data = await res.json();
            document.getElementById('file-list').innerHTML = data.map(p => `
                <div onclick="loadFile('${p.name}')" class="p-2 cursor-pointer border border-cyan-900/30 hover:bg-cyan-900/20 text-[12px] flex justify-between">
                    <span>${p.name}</span>
                    <span class="${p.status === 'Running' ? 'text-green-500' : 'text-gray-600'}">‚óè</span>
                </div>
            `).join('');
        }

        async function loadFile(name) {
            activeFile = name;
            document.getElementById('active-file-label').innerText = name;
            const res = await fetch(`/api/read/${name}`);
            document.getElementById('editor').value = await res.text();
            fetchFiles();
        }

        function handleTyping() {
            document.getElementById('auto-save-status').innerText = "AUTO_SAVE: TYPING...";
            clearTimeout(saveTimeout);
            saveTimeout = setTimeout(() => saveFile(true), 2000);
        }

        async function saveFile(isAuto = false) {
            if(!activeFile) return;
            await fetch('/api/save', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ filename: activeFile, content: document.getElementById('editor').value })
            });
            document.getElementById('auto-save-status').innerText = "AUTO_SAVE: READY";
            if(!isAuto) alert("Manual Save Success!");
        }

        function deploy() { socket.emit('run-script', { filename: activeFile }); }
        function stop() { socket.emit('stop-script', { filename: activeFile }); }
        function syncGit() { socket.emit('github-sync', { repoUrl: document.getElementById('git-url').value }); }
        function runCmd() { socket.emit('terminal-input', document.getElementById('term-cmd').value); }
        function createNew() {
            const name = document.getElementById('new-name').value;
            if(!name) return;
            activeFile = name.endsWith('.py') ? name : name + '.py';
            document.getElementById('editor').value = "print('Hello World')";
            saveFile();
            fetchFiles();
        }

        socket.on('terminal-data', (data) => {
            const term = document.getElementById('terminal');
            const div = document.createElement('div');
            div.style.color = data.type === 'error' ? '#ff3333' : (data.type === 'system' ? '#ffea00' : '#00f2ff');
            div.innerHTML = `<span class="opacity-30">[${new Date().toLocaleTimeString()}]</span> ${data.data}`;
            term.appendChild(div);
            term.scrollTop = term.scrollHeight;
        });

        socket.on('status-change', () => fetchFiles());
        fetchFiles();
    </script>
</body>
                  </html>
